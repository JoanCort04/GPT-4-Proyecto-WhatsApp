<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../css/fonts.css">
</head>

<body class="flex items-center justify-center h-screen bg-gradient-to-r from-[#003366] via-[#1a3b5d] to-[#336699]">
    <div class="w-full max-w-sm p-6 bg-[#1b263b] rounded-lg shadow-md">
        <header class="text-center mb-6">
            <h1 class="text-3xl font-bold text-[#e0e1dd] font-parkinsans">
                Capybara Chat
            </h1>
        </header>
        <h2 class="text-2xl font-bold text-center text-[#e0e1dd] mb-6 font-parkinsans">
            Iniciar Sesión
        </h2>
        <form id="login-form" class="space-y-4">
            <div>
                <label for="username" class="block text-sm font-medium text-[#e0e1dd] font-outfit">
                    Usuario:
                </label>
                <input type="text" id="username" name="username" required
                    class="w-full px-4 py-2 mt-1 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#415a77] font-gabarito" />
            </div>
            <div>
                <label for="password" class="block text-sm font-medium text-[#e0e1dd] font-outfit">
                    Contraseña:
                </label>
                <input type="password" id="password" name="password" required
                    class="w-full px-4 py-2 mt-1 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#415a77] font-gabarito" />
            </div>
            <button type="submit"
                class="w-full px-4 py-2 font-bold text-white bg-[#415a77] rounded-lg hover:bg-[#778da9] focus:outline-none focus:ring-2 focus:ring-[#415a77] font-outfit">
                Ingresar
            </button>
            <p id="error-message" class="hidden text-red-500 text-center font-outfit"></p>
        </form>
    </div>    
</body>

<script type="module">
    import { validar_login } from "../../modulos/auth.js";

    document.addEventListener("DOMContentLoaded", () => {
        const loginForm = document.getElementById("login-form");

        if (!loginForm) {
            console.error("Formulario de login no encontrado");
            return;
        }

        loginForm.addEventListener("submit", async (event) => {
            event.preventDefault();

            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;
            const errorMessage = document.getElementById("error-message");

            errorMessage.classList.add("hidden"); // Oculta el mensaje de error al intentar de nuevo

            try {
                const token = await validar_login(username, password);
                if (!token) {
                    errorMessage.textContent = "Usuario o contraseña incorrectos";
                    errorMessage.classList.remove("hidden");
                }
            } catch (error) {
                console.error("Error en el inicio de sesión:", error);
                errorMessage.textContent = "Error en el servidor. Inténtalo de nuevo.";
                errorMessage.classList.remove("hidden");
            }
        });
    });
</script>


</html>